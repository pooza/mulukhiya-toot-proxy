- $lookup:
    from: users
    localField: userId
    foreignField: _id
    as: user
- $addFields:
    user._id_string:
      $toString: $user._id
- $match:
    tags: <%= params[:tag] %>
    visibility: <%= params[:visibility] %>
    user._id_string:
      $ne: <%= params[:test_account]._id %>
<% if params[:local] -%>
    _user.host: null
<% end -%>
<% if params[:limit] -%>
- $limit: <%= params[:limit] %>
<% end -%>
- $sort:
    createdAt: -1
